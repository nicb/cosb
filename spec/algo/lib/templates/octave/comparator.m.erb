%
% comparator.m.erb:
%
% this is used to compare csound and octave outputs
%
pkg load signal;
pkg load statistics;

[csound_sig sr] = audioread("<%= self.in_csound_file %>");
[octave_sig sr] = audioread("<%= self.in_octave_file %>");
sinc = 1/sr;
dur = length(csound_sig)/sr;
t = [0:sinc:dur-sinc]';
offset = dur/2;
s_offset = round(offset * sr);

diff_left = abs(csound_sig(:,1) .- octave_sig(:,1));
diff_right = abs(csound_sig(:,2) .- octave_sig(:,2));

devtn = [ std(diff_left) std(diff_right) ];

printf("%.8f|%.8f\n", devtn(1), devtn(2));

figure(1, "visible", "off")
subplot(2,1,1)
  plot(t, diff_left)
  axis([offset dur])
subplot(2,1,2)
  plot(t, diff_right)
  axis([offset dur])

print("<%= self.output_plot_root %>_1.pdf", "-dpdf")

figure(2, "visible", "off")
subplot(2,1,1)
  plot(t, csound_sig(:,1),';csound;', t, octave_sig(:,1), ';octave;')
  axis([offset dur])
subplot(2,1,2)
  plot(t, csound_sig(:,2), ';csound;', t, octave_sig(:,2), ';octave;')
  axis([offset dur])

print("<%= self.output_plot_root %>_2.pdf", "-dpdf")
